		location /aiva/ws {
			proxy_pass http://localhost:3001;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
			
			# WebSocket specific timeouts
			proxy_read_timeout 86400;
			proxy_send_timeout 86400;
			
			# Disable buffering for WebSocket
			proxy_buffering off;
		}

		# Widget JavaScript file with CORS headers
		location /aiva/widget.js {
			proxy_pass http://localhost:62001/widget.js;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;

			# CORS headers
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Methods' 'GET, OPTIONS' always;
			add_header 'Access-Control-Allow-Headers' 'Content-Type' always;

			# CRITICAL: Cross-Origin-Resource-Policy
			add_header 'Cross-Origin-Resource-Policy' 'cross-origin' always;

			# Content type
			add_header 'Content-Type' 'application/javascript; charset=utf-8' always;
			add_header 'Cache-Control' 'public, max-age=3600' always;

			# Remove any conflicting headers from backend
			proxy_hide_header 'Cross-Origin-Resource-Policy';
		}

		# Public Chat API with CORS
		location /aiva/api/public/ {
			# Handle preflight OPTIONS request
			if ($request_method = 'OPTIONS') {
			add_header 'Access-Control-Allow-Origin' '*' always;
				add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
				add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization' always;
				add_header 'Access-Control-Max-Age' 1728000;
				add_header 'Content-Length' 0;
				return 204;
			}

			proxy_pass http://localhost:62001/api/public/;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;

			# Hide CORS headers from backend to prevent duplicates
			proxy_hide_header 'Access-Control-Allow-Origin';
			proxy_hide_header 'Access-Control-Allow-Methods';
			proxy_hide_header 'Access-Control-Allow-Headers';
			proxy_hide_header 'Access-Control-Allow-Credentials';
			   

			# CORS headers
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
			add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization' always;
		}

		location /aiva {
			#alias /var/www/html/intellicon/custom/aiva/build;
			index index.html;
			try_files $uri $uri/ /aiva/index.html;
		}

		location /aiva/api/ {
			proxy_pass http://localhost:62001/api/;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
		}

		location /aiva/swagger/ {
			proxy_pass http://localhost:62001/swagger/;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
		}